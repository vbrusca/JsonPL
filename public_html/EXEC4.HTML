<html>
   <head>
      <title>JsonPL v0.5.1</title>
      <script type="text/javascript" src="exec4.js"></script>
      <script type="text/javascript">
         var code = {
            "sys": "class",
            "name": "test1",
            "call": {"sys": "call", "name": "testFunction1", "args": [{"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}}]},
            "vars": [		
               {
                  "sys": "var",
                  "name": "tmp1",
                  "val": {
                     "sys": "val",
                     "type": "int",
                     "v": "5"
                  }
               },
               {
                  "sys": "var",
                  "name": "tmp2",
                  "val": {
                     "sys": "val",
                     "type": "bool",
                     "v": "false"
                  }         
               },
               {
                  "sys": "var",
                  "name": "tmp3",
                  "val": {
                     "sys": "val",
                     "type": "int[]",
                     "len": "0",
                     "v": [
                        
                     ]
                  }         
               },
               {
                  "sys": "var",
                  "name": "tmp4",
                  "val": {
                     "sys": "val",
                     "type": "int[]",
                     "len": "2",
                     "v": [
                        {"sys":"var", "name":"0", "val":{"sys":"val", "type":"int", "v":"0"}},
                        {"sys":"var", "name":"1", "val":{"sys":"val", "type":"int", "v":"1"}}                        
                     ]
                  }         
               },
               {
                  "sys": "var",
                  "name": "tmp5",
                  "val": {
                     "sys": "val",
                     "type": "string",
                     "v": "#.vars.tmp1"
                  }
               }               
            ],
            "funcs": [
               {
                  "sys": "func",
                  "name": "testFunction1",
                  "args": [ 
                     {
                        "sys": "arg",
                        "name": "i1",
                        "val": {
                           "sys": "val",
                           "type": "int",
                           "v": "0"
                        }
                     }
                  ],
                  "vars": [
                     {
                        "sys": "var",
                        "name": "b1",
                        "val": {
                           "sys": "val",
                           "type": "bool",
                           "v": "false"
                        }
                     },
                     {
                        "sys": "var",
                        "name": "name1",
                        "val": {
                           "sys": "val",
                           "type": "string",
                           "v": "tmp1"
                        }
                     },
                     {
                        "sys": "var",
                        "name": "name2",
                        "val": {
                           "sys": "val",
                           "type": "string",
                           "v": "name1"
                        }
                     }
                  ],
                  "ret": {
                     "sys": "val",
                     "type": "bool",
                     "v": "false"
                  },
                  "lines": [
                     {"sys": "call", "name": "testFunction3", "args": [{"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}}]}
                  ]
               },
               {
                  "sys": "func",
                  "name": "testFunction2",
                  "args": [
                     {
                        "sys": "arg",
                        "name": "i1",
                        "val": {
                           "sys": "val",
                           "type": "int",
                           "v": "0"
                        }
                     }
                  ],
                  "vars": [
                     {
                        "sys": "var",
                        "name": "b1",
                        "val": {
                           "sys": "val",
                           "type": "bool",
                           "v": "false"
                        }
                     },
                     {
                        "sys": "var",
                        "name": "tmp1",
                        "val": {
                           "sys": "val",
                           "type": "int",
                           "v": "5"
                        }
                     }            
                  ],
                  "ret": {
                     "sys": "val",
                     "type": "bool",
                     "v": "false"
                  },
                  "lines": [
                     {
                        "sys": "asgn",
                        "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.vars.tmp1"}},
                        "op": {"sys":"op", "type":"asgn", "v":"="},
                        "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}}
                     },
                     {"sys": "return", "val": {"sys":"const", "val":{"sys": "val", "type": "bool", "v": "true"}}}
                  ]
               },
               {
                  "sys": "func",
                  "name": "testFunction3",
                  "args": [
                     {
                        "sys": "arg",
                        "name": "i1",
                        "val": {
                           "sys": "val",
                           "type": "int",
                           "v": "0"
                        }
                     }
                  ],
                  "vars": [
                     {
                        "sys": "var",
                        "name": "b1",
                        "val": {
                           "sys": "val",
                           "type": "bool",
                           "v": "false"
                        }
                     }
                  ],
                  "ret": {
                     "sys": "val",
                     "type": "bool",
                     "v": "false"
                  },
                  "lines": [
                     {"sys": "call", "name": "SYS::wr", "args": [{"sys": "const", "val":{"sys": "val", "type": "string", "v": "hello world"}}]},
                     {"sys":"return", "val": {"sys":"const", "val":{"sys": "val", "type": "bool", "v":"true"}}}
                  ]
               }
            ],
            "ret": {
               "sys": "val",
               "type": "bool",
               "v": "false"
            }
         };

         var code2 = {
            "sys": "class",
            "name": "test2",
            "call": {"sys": "call", "name": "main", "args": []},
            "vars": [
               {
                  "sys": "var",
                  "name": "tmp1",
                  "val": {
                     "sys": "val",
                     "type": "bool",
                     "v": "false"
                  }
               },
               {
                  "sys": "var",
                  "name": "tmp2",
                  "val": {
                     "sys": "val",
                     "type": "bool",
                     "v": "false"
                  }         
               },
               {
                  "sys": "var",
                  "name": "tmp3",
                  "val": {
                     "sys": "val",
                     "type": "bool",
                     "v": "false"
                  }         
               }      
            ],
            "funcs": [
               {
                  "sys": "func",
                  "name": "main",
                  "args": [],
                  "vars": [],
                  "ret": {
                     "sys": "val",
                     "type": "bool",
                     "v": "false"
                  },
                  "lines": [
                     {
                        "sys": "asgn",
                        "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}},
                        "op": {"sys":"op", "type":"asgn", "v":"="},
                        "right": {"sys": "call", "name": "SYS::job1", "args": []}
                     },
                     {
                        "sys": "if",
                        "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}},
                        "op": {"sys":"op", "type":"bex", "v":"=="},
                        "right": {"sys":"const", "val": {"sys": "val", "type": "bool", "v": "true"}},
                        "thn": [
                           {
                              "sys": "asgn",
                              "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp2"}},
                              "op": {"sys":"op", "type":"asgn", "v":"="},
                              "right": {"sys": "call", "name": "SYS::job2", "args": []}
                           },
                           {
                              "sys": "if",
                              "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp2"}},
                              "op": {"sys":"op", "type":"bex", "v":"=="},
                              "right": {"sys":"const", "val": {"sys": "val", "type": "bool", "v": "true"}},
                              "thn": [
                                 {
                                    "sys": "asgn",
                                    "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp3"}},
                                    "op": {"sys":"op", "type":"asgn", "v":"="},
                                    "right": {"sys": "call", "name": "SYS::job3", "args": []}
                                 }
                              ],
                              "els": [
                              ]
                           }            
                        ],
                        "els": [
                        ]
                     }
                  ]
               }
            ],
            "ret": {
               "sys": "val",
               "type": "bool",
               "v": "false"
            }
         };

         //EXTRA DEMO CODE
         /*
             ,
            {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.vars.tmp1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}
            },
            {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.args.i1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}
            },
            {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.b1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys": "bex", "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.vars.tmp1"}}, "op": {"sys":"op", "type":"bex", "v":"=="}, "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.args.i1"}}}
            },
            {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.b1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys": "bex", "left": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}, "op": {"sys":"op", "type":"bex", "v":"=="}, "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.args.i1"}}}
            },
            {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.args.i1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys": "exp", "left": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}, "op": {"sys":"op", "type":"exp", "v":"+"}, "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.args.i1"}}}
            }
         */      
         
         /**
          * Name: init
          * Desc: A function to init the test page.
          */
         function init() {
            var txtArea = document.getElementById('message');
         
            jsonPlState.prototype.wr = function(s) {
               if (this.LOGGING === true) {
                  console.log(this.WR_PREFIX + s);
                  txtArea.value += (this.WR_PREFIX + s + "\n");
               }
            };
            
            jsonPlState.prototype.wrObj = function(s) {
               if (this.LOGGING === true) {
                  console.log(this.WR_PREFIX + JSON.stringify(s, null, 2));
                  txtArea.value += (this.WR_PREFIX + JSON.stringify(s, null, 2) + "\n");
               }
            };
         
            /////////////////////////TEST SECTION
            var jpl = new jsonPlState();
            jpl.program = JSON.parse(JSON.stringify(code));
            
            if(!jpl.validateSysObjClass(jpl.program)) {
               jpl.wr("runProgram: Error: could not validate the class object.");
               return;
            }

            var res = null;
            var tmp = null;


            /////////////////////////////////////////////////////////////////////////////
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.[$.vars.name1]"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }            
            jpl.wr("====================== TEST 0.00: Dynamic Class Variable Reference ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 1:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);      


            /////////////////////////TESTS: REFERENCE
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }            
            jpl.wr("====================== TEST 1.00: Class Variable Reference ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 1:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);

            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }                        
            jpl.validateSysObjRef(tmp);
            jpl.wr("====================== TEST 1.10: Function Argument Reference ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 2:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);

            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.vars.b1"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }                        
            jpl.validateSysObjRef(tmp);
            jpl.wr("====================== TEST 1.20: Function Variable Reference ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 3:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);

            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "[#.vars.tmp5]"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }                        
            jpl.validateSysObjRef(tmp);
            jpl.wr("====================== TEST 1.30: Full Dynamic Variable Reference ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 4:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);            


            /////////////////////////TESTS: ASSIGNMENT
            /*
            {
               "sys": "asgn",
               "left": {ref},
               "op": {op & type of asgn}, 
               "right": {ref | const | exp | bex | call}
            }
            */
            tmp = {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}}
            };
            if(!jpl.validateSysObjAsgn(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }
            jpl.wr("====================== TEST 2.00: Assignment (Class variable to function argument) ======================");
            jpl.wrObj(tmp);
            res = jpl.processAsgn(tmp, code.funcs[0]);
            jpl.wr("ASGN RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastAsgnValue", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST ASGN VALUE:");
            jpl.wrObj(res);
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}};
            jpl.wr("REF #.vars.tmp1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);            

            tmp = {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys":"const", "val":{"sys": "val", "type": "int", "v": "32"}}
            };
            if(!jpl.validateSysObjAsgn(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }            
            jpl.wr("====================== TEST 2.10: Assignment (Constant value to function argument) ======================");
            jpl.wrObj(tmp);
            res = jpl.processAsgn(tmp, code.funcs[0]);
            jpl.wr("ASGN RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastAsgnValue", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST ASGN VALUE:");
            jpl.wrObj(res);            

            tmp = {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys": "exp", "left": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}, "op": {"sys":"op", "type":"exp", "v":"+"}, "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}}}
            };
            jpl.wr("====================== TEST 2.20: Assignment (Expression value to function argument) ======================");
            jpl.wrObj(tmp);
            res = jpl.processAsgn(tmp, code.funcs[0]);
            jpl.wr("ASGN RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastAsgnValue", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST ASGN VALUE:");
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastExpReturn", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST EXP RETURN:");
            jpl.wrObj(res);

            tmp = {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.vars.b1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys": "bex", "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}}, "op": {"sys":"op", "type":"bex", "v":"=="}, "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}}}
            };
            jpl.wr("====================== TEST 2.30: Assignment (Boolean Expression value to function variable) ======================");
            jpl.wrObj(tmp);
            res = jpl.processAsgn(tmp, code.funcs[0]);
            jpl.wr("ASGN RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastAsgnValue", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST ASGN VALUE:");
            jpl.wrObj(res);            

            tmp = {
               "sys": "asgn",
               "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.vars.b1"}},
               "op": {"sys":"op", "type":"asgn", "v":"="},
               "right": {"sys": "call", "name": "testFunction3", "args": [{"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}}]}
            };
            jpl.wr("====================== TEST 2.40: Assignment (Function Call value to function variable) ======================");
            jpl.wrObj(tmp);
            res = jpl.processAsgn(tmp, code.funcs[0]);
            jpl.wr("ASGN RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastAsgnValue", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST ASGN VALUE:");
            jpl.wrObj(res);
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}};
            jpl.wr("REF #.vars.tmp1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);


            ///////////////////////////TESTS: BOOLEAN EXPRESSIONS
            /* 
            {
               "sys": "bex",
               "left": {ref | const | exp | bex | call},
               "op": {op & type of bex}, 
               "right": {ref | const | exp | bex | call}
            }
            */   
            tmp = {
               "sys": "bex", 
               "left": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}, 
               "op": {"sys":"op", "type":"bex", "v":"=="}, 
               "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}}
            };
            jpl.wr("====================== TEST 3.00: Boolean Expression (Function argument to Constant value) ======================");
            jpl.wrObj(tmp);
            res = jpl.processBex(tmp, code.funcs[0]);
            jpl.wr("BEX RESULT: (EXPECTS: FALSE)");
            jpl.wrObj(res);            
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}};
            jpl.wr("REF $.args.i1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);            
            
            tmp = {
               "sys": "bex", 
               "left": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}, 
               "op": {"sys":"op", "type":"bex", "v":">="}, 
               "right": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}
            };
            jpl.wr("====================== TEST 3.05: Boolean Expression (Constant value to Constant value) ======================");
            jpl.wrObj(tmp);
            res = jpl.processBex(tmp, code.funcs[0]);
            jpl.wr("BEX RESULT: (EXPECTS: TRUE)");
            jpl.wrObj(res);  
            

            ///////////////////////////TESTS: NUMERIC EXPRESSIONS
            tmp = {
               "sys": "exp", 
               "left": {"sys": "const", "val": {"sys": "val", "type": "int", "v": "25"}}, 
               "op": {"sys":"op", "type":"exp", "v":"+"}, 
               "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}}
            };
            jpl.wr("====================== TEST 4.00: Expression ======================");
            jpl.wrObj(tmp);
            res = jpl.processExp(tmp, code.funcs[0]);
            jpl.wr("EXP RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}};
            jpl.wr("REF $.args.i1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);            


            ///////////////////////////TESTS: FUNCTION CALLS
            tmp = {
               "sys": "call", 
               "name": "testFunction2", 
               "args": [
                  {
                     "sys": "ref", 
                     "val":{
                        "sys": "val", 
                        "type": "int", 
                        "v": "#.vars.tmp1"
                     }
                  }
               ]   
            };
            jpl.wr("====================== TEST 5.00: Function Call ======================");
            jpl.wrObj(tmp);
            res = jpl.processCall(tmp, code.funcs[1]);
            jpl.wr("CALL RESULT:");
            jpl.wrObj(res);
            jpl.wr("CALL FUNCS[1] ARGS:");
            jpl.wrObj(code.funcs[1].args);

            tmp = {
               "sys": "if",
               "left": {"sys": "const", "val": {"sys": "val","type": "bool","v": "true"}},
               "op": {"sys":"op", "type":"bex", "v":"=="},
               "right": {"sys": "const", "val": {"sys": "val","type": "bool","v": "true"}},
               "thn": [
                  {
                     "sys": "asgn",
                     "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}},
                     "op": {"sys":"op", "type":"asgn", "v":"="},
                     "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}}
                  }
               ],
               "els": [
                  {
                     "sys": "asgn",
                     "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}},
                     "op": {"sys":"op", "type":"asgn", "v":"="},
                     "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}}
                  }
               ]
            };
            jpl.wr("====================== TEST 6.00: If Statement ======================");
            jpl.wrObj(tmp);
            res = jpl.processIf(tmp, code.funcs[0]);
            jpl.wr("IF RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}};
            jpl.wr("REF $.args.i1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}};
            jpl.wr("REF #.vars.tmp1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastAsgnValue", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST ASGN VALUE:");
            jpl.wrObj(res);            
            

            tmp = {
               "sys": "for",
               "start": {"sys": "const", "val": {"sys": "val","type": "int","v": "0"}},
               "stop": {"sys": "const", "val": {"sys": "val","type": "int","v": "10"}},
               "inc": {"sys": "const", "val": {"sys": "val","type": "int","v": "1"}},
               "lines": [
                  {
                     "sys": "asgn",
                     "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}},
                     "op": {"sys":"op", "type":"asgn", "v":"="},
                     "right": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}}
                  }
               ]
            };
            jpl.wr("====================== TEST 7.00: For Loop ======================");
            jpl.wrObj(tmp);
            res = jpl.processFor(tmp, code.funcs[0]);
            jpl.wr("FOR RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}};
            jpl.wr("REF $.args.i1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp1"}};
            jpl.wr("REF #.vars.tmp1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastAsgnValue", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST ASGN VALUE:");
            jpl.wrObj(res);

            jpl.wr("====================== TEST 7.10: For Loop ======================");
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}};
            jpl.wr("REF $.args.i1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);
            tmp = {
               "sys": "for",
               "start": {"sys": "const", "val": {"sys": "val","type": "int","v": "0"}},
               "stop": {"sys": "const", "val": {"sys": "val","type": "int","v": "10"}},
               "inc": {"sys": "const", "val": {"sys": "val","type": "int","v": "1"}},
               "lines": [
                  {
                     "sys": "asgn",
                     "left": {"sys":"ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}},
                     "op": {"sys":"op", "type":"asgn", "v":"="},
                     "right": {"sys": "exp", "left": {"sys": "ref", "val": {"sys": "val", "type": "int", "v": "$.args.i1"}}, "op": {"sys":"op", "type":"exp", "v":"+"}, "right": {"sys":"const", "val":{"sys": "val", "type": "int", "v": "1"}}}
                  }
               ]
            };
            
            jpl.wrObj(tmp);
            res = jpl.processFor(tmp, code.funcs[0]);
            jpl.wr("FOR RESULT:");
            jpl.wrObj(res);
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "$.args.i1"}};
            jpl.wr("REF $.args.i1 VAL:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);
            tmp = {"sys": "call", "name": "SYS::getLastAsgnValue", "args": []};
            res = jpl.processCall(tmp, code.funcs[0]);
            jpl.wr("LAST ASGN VALUE:");
            jpl.wrObj(res);

            jpl.wr("====================== TEST 8.00: Call Statement ======================");
            var callObj = code.call;
            var callFuncName = callObj.name;
            var callFunc = jpl.findFunc(callFuncName);
            res = jpl.processCall(callObj, callFunc);
            jpl.wr("RUN FUNCTION 1: " + callFuncName);
            jpl.wrObj(res);

            res = jpl.processCall(callObj, callFunc);
            jpl.wr("RUN FUNCTION 2: " + callFuncName);
            jpl.wrObj(res);

            jpl = new jsonPlState();
            jpl.program = JSON.parse(JSON.stringify(code));
            tmp = jpl.program;
            jpl.wr("====================== TEST 9.00: Full Program 1 ======================");
            jpl.wrObj(tmp);
            jpl.runProgram();

            jpl.wr("====================== TEST 10.00: Full Program 2 ======================");
            var jplData = [ "33", "true" ];
            var jplCode = JSON.parse(JSON.stringify(code));

            function test(dataFromAjax, jplCodeFromAjax) {
               console.log("test method");
               var jpl = new jsonPlState();
               jpl.program = jplCodeFromAjax;
               jpl.program.vars[0].val.v = dataFromAjax[0];
               jpl.program.vars[1].val.v = dataFromAjax[1];   
               var tmp = jpl.runProgram();
               return tmp.val.v;
            }

            jpl.wr("TEST METHOD");
            jpl.wr(test.toString());

            jpl.wr("TEST METHOD DATA");
            jpl.wr(jplData.toString());

            var jplRes = test(jplData, jplCode);
            jpl.wr("Example Code Result: " + jplRes);

            jpl = new jsonPlState();
            jpl.program = JSON.parse(JSON.stringify(code2));
            tmp = jpl.program;
            jpl.wr("====================== TEST 11.00: Full Program 3 ======================");
            jpl.wrObj(tmp);
            jpl.runProgram();
            

            /////////////////////////////////////////////////////////////////////////////
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.[$.vars.name1]"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }            
            jpl.wr("====================== TEST 12.00: Dynamic Class Variable Reference ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 1:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);            
            
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.[$.vars.[$.vars.name2]]"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }            
            jpl.wr("====================== TEST 12.01: Dynamic Class Variable Reference 2 ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 1:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);


			   /////////////////////////////////////////////////////////////////////////////
            //tmp = '{"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.[$.vars.[$.vars.name2]]"}};';
			   tmp = '{"sys": "ref", "val":{"sys": "val", "type": "int", "v": "@(repl::classOrFunc).vars.[$.@(repl::varsOrArgs).[$.vars.@(repl::varOrArgName)]]"}}';
			   jpl.wr("====================== TEST 13.00: Pre-Processing Replacement Directives Prep ======================");
			   jpl.wr("Check for replace directives in string form.");
            if(jpl.hasReplDirectives(tmp)) {
               jpl.wr("Found replace directives...");
               jpl.wr("Before: " + tmp);
               var keys = [];
               var vals = [];
               keys.push('varOrArgName');
               vals.push('name2');
               
               keys.push('varsOrArgs');
               vals.push('vars');				
               
               keys.push('classOrFunc');
               vals.push('#');				
               tmp = jpl.processReplDirectives(keys, vals, tmp);
               jpl.wr("After: " + tmp);				
            }
			   tmp = JSON.parse(tmp);
			
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }
                    
            jpl.wr("====================== TEST 13.00: Pre-Processing Replacement Directives Execution ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 1:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);
            
            
            /////////////////////////TESTS: REFERENCE ARRAY
            var jpl = new jsonPlState();
            jpl.program = JSON.parse(JSON.stringify(code));
            
            if(!jpl.validateSysObjClass(jpl.program)) {
               jpl.wr("runProgram: Error: could not validate the class object.");
               return;
            }

            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp4"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }            
            jpl.wr("====================== TEST 13.01: Class Variable Array Reference ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 1:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);
            
            tmp = {"sys": "ref", "val":{"sys": "val", "type": "int", "v": "#.vars.tmp4.0"}};
            if(!jpl.validateSysObjRef(tmp)) {
               jpl.wr("!invalid JSON");
               return;
            }            
            jpl.wr("====================== TEST 13.02: Class Variable Array Index Reference ======================");
            jpl.wrObj(tmp);
            jpl.wr("REF 1:");
            res = jpl.processRef(tmp, code.funcs[0]);
            jpl.wrObj(res);            
         }
      </script>
   </head>
   <body style="padding: 4px;" onload="init()">
<span style="font-size:14px;">Test Results:</span><br/>
<textarea cols="125" rows="25" id="message" style="font-size:12px;">
</textarea>
   </body>
</html>